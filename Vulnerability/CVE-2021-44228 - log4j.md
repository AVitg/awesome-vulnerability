# Apache Log4j2 remote code execution CVE-2021-44228

Log4j’s JNDI support has not restricted what names could be resolved. Some protocols are unsafe or can allow remote code execution. Log4j now limits the protocols by default to only java, ldap, and ldaps and limits the ldap protocols to only accessing Java primitive objects by default served on the local host.

One vector that allowed exposure to this vulnerability was Log4j’s allowance of Lookups to appear in log messages. As of Log4j 2.15.0 this feature is now disabled by default. While an option has been provided to enable Lookups in this fashion, users are strongly discouraged from enabling it.

## At risk

All versions before Log4j 2.16.0

## Mitigation

Update to Log4j 2.16.0

https://logging.apache.org/log4j/2.x/download.html

### Workaround

Add the following parameter to the vulnerable java runtime

```
-Dlog4j2.formatMsgNoLookups=true
```

### Vendor bulletins

* https://gist.github.com/SwitHak/b66db3a06c2955a9cb71a8718970c592

## Scan and detection

### Tenable nessus plugins

* 156018	Debian DLA-2842-1 : apache-log4j2 - LTS security update	Nessus	Debian Local Security Checks	
* 156017	SIP Script Remote Command Execution via log4shell	Nessus	General	
* 156016	Apache Log4Shell RCE detection via Path Enumeration (Direct Check HTTP)	Nessus	CGI abuses	
* 156015	Debian DSA-5020-1 : apache-log4j2 - security update	Nessus	Debian Local Security Checks	
* 156014	Apache Log4Shell RCE detection via callback correlation (Direct Check HTTP)	Nessus	Web Servers	
* 113075	Apache Log4j Remote Code Execution (Log4Shell)	Web Application Scanning	Component Vulnerability	
* 156002	Apache Log4j < 2.15.0 Remote Code Execution (Windows)	Nessus	Misc.	
* 155999	Apache Log4j < 2.15.0 Remote Code Execution (Nix)	Nessus	Misc.	
* 155998	Apache Log4j Message Lookup Substitution RCE (Log4Shell) (Direct Check)	Nessus	Web Servers	

https://www.tenable.com/cve/CVE-2021-44228

### Burp Suite

* https://portswigger.net/bappstore/b011be53649346dd87276bca41ce8e8f

### Scripts

* https://github.com/fullhunt/log4j-scan
* https://gist.github.com/byt3bl33d3r/46661bc206d323e6770907d259e009b6

## Indicators of compromise

* https://github.com/Neo23x0/Fenrir

## PoC

* https://github.com/pimps/JNDI-Exploit-Kit
* https://github.com/cyberstruggle/L4sh
* https://github.com/morphuslabs/get-log4j-exploit-payload

## Honeypots

* https://github.com/BinaryDefense/log4j-honeypot-flask


## Social media

* https://www.reddit.com/r/blueteamsec/comments/rd38z9/log4j_0day_being_exploited/
